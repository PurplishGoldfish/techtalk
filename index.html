<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TechTalk - Crypto/Tech News</title>
<style>
:root {
--bg: #0f172a;
--card: #1e293b;
--text: #f1f5f9;
--accent: #3b82f6;
--secondary: #64748b;
--success: #10b981;
--danger: #ef4444;
--border: #334155;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
background: var(--bg);
color: var(--text);
line-height: 1.6;
padding: 20px;
max-width: 1600px;
margin: 0 auto;
display: grid;
grid-template-columns: 200px 1fr 200px;
gap: 20px;
position: relative;
}

/* Top Banner Ad Row */
.top-banner-row {
grid-column: 1 / -1;
display: flex;
gap: 20px;
justify-content: space-between;
margin-bottom: 20px;
}

.top-banner-ad {
flex: 1;
height: 90px;
}

.top-banner-ad iframe {
width: 100% !important;
height: 90px !important;
}

/* Main Content */
.main-content {
grid-column: 2;
width: 100%;
max-width: 1200px;
position: relative;
}

/* Left Sidebar Ads - 2 columns */
.left-sidebar {
grid-column: 1;
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
position: sticky;
top: 20px;
height: fit-content;
align-content: start;
}

/* Right Sidebar Ads - 2 columns */
.right-sidebar {
grid-column: 3;
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
position: sticky;
top: 20px;
height: fit-content;
align-content: start;
}

/* Ad Frame Styles */
.ad-frame {
position: relative;
z-index: 99998;
margin-bottom: 15px;
background: var(--card);
border-radius: 8px;
overflow: hidden;
border: 1px solid var(--border);
transition: transform 0.2s;
}

.ad-frame:hover {
transform: translateY(-2px);
border-color: var(--accent);
}

.ad-frame iframe {
border: 0;
padding: 0;
width: 100%;
height: auto;
overflow: hidden;
display: block;
margin: 0;
}

/* Square Ads */
.square-ad {
width: 120px;
height: 120px;
}

.square-ad iframe {
height: 120px !important;
}

/* Small Square Ads */
.small-square-ad {
width: 90px;
height: 90px;
}

.small-square-ad iframe {
height: 90px !important;
}

/* Button Ads */
.button-ad {
width: 120px;
height: 60px;
}

.button-ad iframe {
height: 60px !important;
}

/* Vertical Ad Styles */
.vertical-ad {
width: 160px;
height: 600px;
}

.vertical-ad iframe {
height: 600px !important;
}

/* Medium Rectangle Ads */
.rectangle-ad {
width: 180px;
height: 150px;
}

.rectangle-ad iframe {
height: 150px !important;
}

/* Wide Skyscraper */
.wide-skyscraper {
width: 180px;
height: 600px;
}

.wide-skyscraper iframe {
height: 600px !important;
}

/* Half-page Ad */
.half-page-ad {
width: 180px;
height: 300px;
}

.half-page-ad iframe {
height: 300px !important;
}

/* Leaderboard Ad (top) */
.leaderboard-ad {
width: 100%;
height: 90px;
}

.leaderboard-ad iframe {
height: 90px !important;
width: 100% !important;
}

/* In-content Ads */
.in-content-ad {
width: 100%;
height: 90px;
margin: 20px 0;
}

.in-content-ad iframe {
height: 90px !important;
width: 100% !important;
}

/* Floating Side Ads */
.floating-left {
position: fixed;
left: 10px;
top: 50%;
transform: translateY(-50%);
z-index: 99999;
width: 160px;
}

.floating-right {
position: fixed;
right: 10px;
top: 50%;
transform: translateY(-50%);
z-index: 99999;
width: 160px;
}

/* Bottom Banner Row */
.bottom-banner-row {
grid-column: 1 / -1;
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 20px;
margin-top: 30px;
}

.bottom-banner-ad {
height: 90px;
}

.bottom-banner-ad iframe {
height: 90px !important;
width: 100% !important;
}

/* Article Inline Ads */
.article-inline-ad {
width: 100%;
height: 250px;
margin: 20px 0;
display: none; /* Will show via JavaScript */
}

.article-inline-ad iframe {
height: 250px !important;
width: 100% !important;
}

/* Sticky Footer Ad */
.sticky-footer-ad {
position: fixed;
bottom: 0;
left: 0;
right: 0;
background: var(--card);
border-top: 1px solid var(--border);
z-index: 100000;
height: 50px;
display: flex;
justify-content: center;
align-items: center;
padding: 0 20px;
}

.sticky-footer-ad .ad-frame {
margin: 0;
height: 50px;
flex: 1;
max-width: 728px;
}

.sticky-footer-ad iframe {
height: 50px !important;
}

/* Header adjustments */
header {
text-align: center;
margin-bottom: 2rem;
padding-bottom: 1rem;
border-bottom: 2px solid var(--border);
position: relative;
}

h1 {
font-size: 2.5rem;
margin-bottom: 0.5rem;
background: linear-gradient(135deg, var(--accent), #8b5cf6);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
display: inline-block;
padding-right: 300px; /* Space for header ad */
}

.header-ad {
position: absolute;
right: 0;
top: 0;
width: 300px;
height: 250px;
display: inline-block;
}

.header-ad iframe {
height: 250px !important;
width: 100% !important;
}

.tagline {
color: var(--secondary);
font-size: 1.1rem;
}

/* Controls with ads between buttons */
.controls {
display: flex;
gap: 15px;
flex-wrap: wrap;
margin: 2rem 0;
padding: 1rem;
background: var(--card);
border-radius: 10px;
position: relative;
}

.controls-ad {
width: 120px;
height: 60px;
display: inline-block;
vertical-align: middle;
}

.category-btn {
padding: 0.5rem 1.5rem;
border: none;
background: var(--border);
color: var(--text);
border-radius: 20px;
cursor: pointer;
transition: all 0.2s;
font-weight: 500;
position: relative;
}

.category-btn:hover {
background: var(--secondary);
}

.category-btn.active {
background: var(--accent);
color: white;
}

.refresh-btn {
margin-left: auto;
padding: 0.5rem 1.5rem;
background: var(--success);
color: white;
border: none;
border-radius: 6px;
cursor: pointer;
font-weight: 500;
}

.refresh-btn:disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* Articles grid with ads */
.articles-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
gap: 1.5rem;
margin-top: 1rem;
position: relative;
}

/* Ad after every 2 articles */
.article-card:nth-child(6n+3)::after {
content: '';
display: block;
grid-column: 1 / -1;
margin: 20px 0;
}

.article-card {
background: var(--card);
border-radius: 12px;
padding: 1.5rem;
border: 1px solid var(--border);
transition: transform 0.2s, border-color 0.2s;
display: flex;
flex-direction: column;
position: relative;
}

/* Small ad in corner of article card */
.article-card-ad {
position: absolute;
bottom: 10px;
right: 10px;
width: 120px;
height: 60px;
opacity: 0.7;
transition: opacity 0.2s;
}

.article-card-ad:hover {
opacity: 1;
}

.article-card:hover {
transform: translateY(-2px);
border-color: var(--accent);
}

.article-header {
display: flex;
justify-content: space-between;
align-items: start;
margin-bottom: 1rem;
position: relative;
}

/* Small ad in article header */
.article-header-ad {
position: absolute;
right: 0;
top: 0;
width: 120px;
height: 30px;
}

.source-tag {
background: var(--accent);
color: white;
padding: 0.3rem 0.8rem;
border-radius: 20px;
font-size: 0.85rem;
font-weight: 600;
}

.time-ago {
color: var(--secondary);
font-size: 0.9rem;
}

.article-title {
font-size: 1.2rem;
font-weight: 600;
margin-bottom: 1rem;
line-height: 1.4;
flex-grow: 1;
}

.article-link {
color: var(--accent);
text-decoration: none;
font-weight: 500;
display: inline-flex;
align-items: center;
gap: 0.5rem;
margin-top: auto;
}

.article-link:hover {
text-decoration: underline;
}

.loading {
text-align: center;
padding: 3rem;
grid-column: 1 / -1;
}

.loading-spinner {
width: 40px;
height: 40px;
border: 3px solid var(--border);
border-top-color: var(--accent);
border-radius: 50%;
animation: spin 1s linear infinite;
margin: 0 auto 1rem;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

.error {
background: var(--danger);
color: white;
padding: 1rem;
border-radius: 8px;
margin: 1rem 0;
display: none;
grid-column: 1 / -1;
}

footer {
margin-top: 3rem;
text-align: center;
color: var(--secondary);
font-size: 0.9rem;
padding-top: 1rem;
border-top: 1px solid var(--border);
grid-column: 1 / -1;
position: relative;
padding-bottom: 60px; /* Space for sticky footer */
}

/* Footer ads */
.footer-ads {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 20px;
margin-top: 2rem;
}

.footer-ad {
height: 90px;
}

.footer-ad iframe {
height: 90px !important;
width: 100% !important;
}

/* Responsive Design */
@media (max-width: 1400px) {
body {
grid-template-columns: 160px 1fr 160px;
}

.left-sidebar, .right-sidebar {
grid-template-columns: 1fr;
}

.floating-left, .floating-right {
display: none;
}

h1 {
padding-right: 250px;
}

.header-ad {
width: 250px;
}
}

@media (max-width: 1200px) {
body {
grid-template-columns: 1fr;
gap: 10px;
}

.main-content {
grid-column: 1;
}

.left-sidebar, .right-sidebar {
display: none;
}

.top-banner-row, .bottom-banner-row {
grid-template-columns: repeat(2, 1fr);
}

h1 {
padding-right: 0;
}

.header-ad {
position: relative;
width: 100%;
margin-top: 20px;
}
}

@media (max-width: 768px) {
body {
padding: 10px;
}

.articles-grid {
grid-template-columns: 1fr;
}

.controls {
flex-direction: column;
align-items: center;
}

.refresh-btn {
margin-left: 0;
margin-top: 1rem;
}

.top-banner-row, .bottom-banner-row {
grid-template-columns: 1fr;
gap: 10px;
}

.footer-ads {
grid-template-columns: 1fr;
}

.sticky-footer-ad {
display: none;
}

.article-card-ad, .article-header-ad {
display: none;
}
}

/* Print styles - hide ads */
@media print {
.ad-frame, .floating-left, .floating-right, .sticky-footer-ad {
display: none !important;
}
}
</style>
</head>
<body>
<!-- Top Banner Row - 4 ads -->
<div class="top-banner-row">
<div class="ad-frame top-banner-ad">
<iframe data-aa='2424101' src='//acceptable.a-ads.com/2424101/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame top-banner-ad">
<iframe data-aa='2424102' src='//acceptable.a-ads.com/2424102/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame top-banner-ad">
<iframe data-aa='2424103' src='//acceptable.a-ads.com/2424103/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame top-banner-ad">
<iframe data-aa='2424104' src='//acceptable.a-ads.com/2424104/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<!-- Floating Left Side Ads -->
<div class="floating-left">
<div class="ad-frame vertical-ad">
<iframe data-aa='2424105' src='//acceptable.a-ads.com/2424105/?size=Vertical' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<!-- Floating Right Side Ads -->
<div class="floating-right">
<div class="ad-frame vertical-ad">
<iframe data-aa='2424106' src='//acceptable.a-ads.com/2424106/?size=Vertical' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<!-- Left Sidebar - 12 ads in 2 columns -->
<div class="left-sidebar">
<div class="ad-frame vertical-ad">
<iframe data-aa='2424107' src='//acceptable.a-ads.com/2424107/?size=Vertical' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame rectangle-ad">
<iframe data-aa='2424108' src='//acceptable.a-ads.com/2424108/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame square-ad">
<iframe data-aa='2424109' src='//acceptable.a-ads.com/2424109/?size=Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame small-square-ad">
<iframe data-aa='2424110' src='//acceptable.a-ads.com/2424110/?size=Small_Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame button-ad">
<iframe data-aa='2424111' src='//acceptable.a-ads.com/2424111/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame wide-skyscraper">
<iframe data-aa='2424112' src='//acceptable.a-ads.com/2424112/?size=Wide_Skyscraper' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame half-page-ad">
<iframe data-aa='2424113' src='//acceptable.a-ads.com/2424113/?size=Half_Page' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame square-ad">
<iframe data-aa='2424114' src='//acceptable.a-ads.com/2424114/?size=Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame rectangle-ad">
<iframe data-aa='2424115' src='//acceptable.a-ads.com/2424115/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame small-square-ad">
<iframe data-aa='2424116' src='//acceptable.a-ads.com/2424116/?size=Small_Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame button-ad">
<iframe data-aa='2424117' src='//acceptable.a-ads.com/2424117/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame square-ad">
<iframe data-aa='2424118' src='//acceptable.a-ads.com/2424118/?size=Square' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<!-- Main Content -->
<div class="main-content">
<header>
<h1>TechTalk</h1>
<div class="ad-frame header-ad">
<iframe data-aa='2424119' src='//acceptable.a-ads.com/2424119/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>
<p class="tagline">Live crypto & tech news from top sources</p>
</header>

<div class="controls">
<button class="category-btn active" data-category="all">All News</button>
<div class="ad-frame controls-ad">
<iframe data-aa='2424120' src='//acceptable.a-ads.com/2424120/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<button class="category-btn" data-category="crypto">Crypto</button>
<div class="ad-frame controls-ad">
<iframe data-aa='2424121' src='//acceptable.a-ads.com/2424121/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<button class="category-btn" data-category="tech">Tech</button>
<button class="category-btn" data-category="ai">AI</button>
<div class="ad-frame controls-ad">
<iframe data-aa='2424122' src='//acceptable.a-ads.com/2424122/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<button class="category-btn" data-category="dev">Dev</button>
<button class="refresh-btn" id="refreshBtn">Refresh News</button>
</div>

<div class="error" id="errorMessage"></div>

<!-- In-content Ad -->
<div class="ad-frame in-content-ad">
<iframe data-aa='2424123' src='//acceptable.a-ads.com/2424123/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>

<div class="articles-grid" id="articlesContainer">
<div class="loading">
<div class="loading-spinner"></div>
<p>Fetching latest headlines...</p>
</div>
</div>

<!-- Article Inline Ads (will be inserted by JS) -->
<div class="ad-frame article-inline-ad" id="inlineAd1">
<iframe data-aa='2424124' src='//acceptable.a-ads.com/2424124/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>

<div class="ad-frame article-inline-ad" id="inlineAd2">
<iframe data-aa='2424125' src='//acceptable.a-ads.com/2424125/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>

<div class="ad-frame article-inline-ad" id="inlineAd3">
<iframe data-aa='2424126' src='//acceptable.a-ads.com/2424126/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>

<footer>
<!-- Footer Ads -->
<div class="footer-ads">
<div class="ad-frame footer-ad">
<iframe data-aa='2424127' src='//acceptable.a-ads.com/2424127/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame footer-ad">
<iframe data-aa='2424128' src='//acceptable.a-ads.com/2424128/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame footer-ad">
<iframe data-aa='2424129' src='//acceptable.a-ads.com/2424129/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<p>TechTalk Aggregator • Updates every 5 minutes • Source links open in new tab</p>
<p style="margin-top: 0.5rem; font-size: 0.8rem;">Powered by RSS feeds from top publications</p>
</footer>
</div>

<!-- Right Sidebar - 12 ads in 2 columns -->
<div class="right-sidebar">
<div class="ad-frame vertical-ad">
<iframe data-aa='2424130' src='//acceptable.a-ads.com/2424130/?size=Vertical' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame rectangle-ad">
<iframe data-aa='2424131' src='//acceptable.a-ads.com/2424131/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame square-ad">
<iframe data-aa='2424132' src='//acceptable.a-ads.com/2424132/?size=Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame small-square-ad">
<iframe data-aa='2424133' src='//acceptable.a-ads.com/2424133/?size=Small_Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame button-ad">
<iframe data-aa='2424134' src='//acceptable.a-ads.com/2424134/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame wide-skyscraper">
<iframe data-aa='2424135' src='//acceptable.a-ads.com/2424135/?size=Wide_Skyscraper' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame half-page-ad">
<iframe data-aa='2424136' src='//acceptable.a-ads.com/2424136/?size=Half_Page' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame square-ad">
<iframe data-aa='2424137' src='//acceptable.a-ads.com/2424137/?size=Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame rectangle-ad">
<iframe data-aa='2424138' src='//acceptable.a-ads.com/2424138/?size=Medium_Rectangle' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame small-square-ad">
<iframe data-aa='2424139' src='//acceptable.a-ads.com/2424139/?size=Small_Square' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame button-ad">
<iframe data-aa='2424140' src='//acceptable.a-ads.com/2424140/?size=Button' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame square-ad">
<iframe data-aa='2424141' src='//acceptable.a-ads.com/2424141/?size=Square' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<!-- Bottom Banner Row - 4 ads -->
<div class="bottom-banner-row">
<div class="ad-frame bottom-banner-ad">
<iframe data-aa='2424142' src='//acceptable.a-ads.com/2424142/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame bottom-banner-ad">
<iframe data-aa='2424143' src='//acceptable.a-ads.com/2424143/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame bottom-banner-ad">
<iframe data-aa='2424144' src='//acceptable.a-ads.com/2424144/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
<div class="ad-frame bottom-banner-ad">
<iframe data-aa='2424145' src='//acceptable.a-ads.com/2424145/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<!-- Sticky Footer Ad -->
<div class="sticky-footer-ad">
<div class="ad-frame">
<iframe data-aa='2424146' src='//acceptable.a-ads.com/2424146/?size=Leaderboard' scrolling='no' title='advertisement'></iframe>
</div>
</div>

<script>
// Configuration - Same as before
const NEWS_SOURCES = {
crypto: [
{
name: "CoinDesk",
url: "https://www.coindesk.com/arc/outboundfeeds/rss/",
category: "crypto",
getFeed: async () => {
const rss = await fetchRSS("https://www.coindesk.com/arc/outboundfeeds/rss/");
return parseRSS(rss);
}
},
{
name: "CoinTelegraph",
url: "https://cointelegraph.com/rss",
category: "crypto",
getFeed: async () => {
try {
const html = await fetchHTML("https://cointelegraph.com/");
return parseCointelegraph(html);
} catch (e) {
return fallbackArticles("CoinTelegraph", "crypto");
}
}
},
{
name: "The Block",
url: "https://www.theblock.co/rss/",
category: "crypto",
getFeed: async () => {
const rss = await fetchRSS("https://www.theblock.co/rss/");
return parseRSS(rss);
}
}
],
tech: [
{
name: "TechCrunch",
url: "https://techcrunch.com/feed/",
category: "tech",
getFeed: async () => {
const rss = await fetchRSS("https://techcrunch.com/feed/");
return parseRSS(rss);
}
},
{
name: "Hacker News",
url: "https://news.ycombinator.com/",
category: "dev",
getFeed: async () => {
const html = await fetchHTML("https://news.ycombinator.com/");
return parseHackerNews(html);
}
},
{
name: "Ars Technica",
url: "https://feeds.arstechnica.com/arstechnica/index",
category: "tech",
getFeed: async () => {
const rss = await fetchRSS("https://feeds.arstechnica.com/arstechnica/index");
return parseRSS(rss);
}
}
],
ai: [
{
name: "OpenAI Blog",
url: "https://openai.com/blog/",
category: "ai",
getFeed: async () => {
try {
const html = await fetchHTML("https://openai.com/blog/");
return parseOpenAI(html);
} catch (e) {
return fallbackArticles("OpenAI", "ai");
}
}
},
{
name: "Anthropic Blog",
url: "https://www.anthropic.com/news",
category: "ai",
getFeed: async () => {
try {
const html = await fetchHTML("https://www.anthropic.com/news");
return parseAnthropic(html);
} catch (e) {
return fallbackArticles("Anthropic", "ai");
}
}
}
]
};

// CORS proxy - using public proxies (fallback chain)
const CORS_PROXIES = [
'https://api.allorigins.win/raw?url=',
'https://corsproxy.io/?',
'https://api.codetabs.com/v1/proxy?quest='
];

// State
let allArticles = [];
let currentCategory = 'all';

// DOM Elements
const articlesContainer = document.getElementById('articlesContainer');
const refreshBtn = document.getElementById('refreshBtn');
const errorMessage = document.getElementById('errorMessage');
const categoryBtns = document.querySelectorAll('.category-btn');

// Initialize
document.addEventListener('DOMContentLoaded', loadNews);

// Event Listeners
refreshBtn.addEventListener('click', loadNews);

categoryBtns.forEach(btn => {
btn.addEventListener('click', () => {
categoryBtns.forEach(b => b.classList.remove('active'));
btn.classList.add('active');
currentCategory = btn.dataset.category;
filterArticles();
});
});

// Main function to load news
async function loadNews() {
refreshBtn.disabled = true;
refreshBtn.textContent = 'Loading...';
showLoading();
hideError();

try {
const promises = [];

// Fetch from all sources
for (const category in NEWS_SOURCES) {
for (const source of NEWS_SOURCES[category]) {
promises.push(
source.getFeed()
.then(articles => {
return articles.map(article => ({
...article,
source: source.name,
category: source.category,
timestamp: new Date().getTime()
}));
})
.catch(error => {
console.error(`Error fetching ${source.name}:`, error);
return [];
})
);
}
}

const results = await Promise.allSettled(promises);

// Combine all articles
allArticles = [];
results.forEach(result => {
if (result.status === 'fulfilled' && result.value) {
allArticles.push(...result.value);
}
});

// Sort by timestamp (newest first)
allArticles.sort((a, b) => b.timestamp - a.timestamp);

// Remove duplicates based on title
allArticles = removeDuplicates(allArticles);

renderArticles();
showInlineAds();

} catch (error) {
console.error('Error loading news:', error);
showError('Failed to load news. Trying fallback data...');
loadFallbackData();
} finally {
refreshBtn.disabled = false;
refreshBtn.textContent = 'Refresh News';
}
}

// Show inline ads between articles
function showInlineAds() {
const inlineAds = document.querySelectorAll('.article-inline-ad');
inlineAds.forEach(ad => ad.style.display = 'block');
}

// Fetch with CORS proxy
async function fetchWithProxy(url) {
let lastError;

for (const proxy of CORS_PROXIES) {
try {
const proxyUrl = proxy + encodeURIComponent(url);
const response = await fetch(proxyUrl, {
headers: {
'Accept': 'application/xml, text/html, application/json',
'User-Agent': 'TechTalkAggregator/1.0'
}
});

if (!response.ok) throw new Error(`HTTP ${response.status}`);

return await response.text();
} catch (error) {
lastError = error;
continue; // Try next proxy
}
}

throw lastError;
}

async function fetchRSS(url) {
return await fetchWithProxy(url);
}

async function fetchHTML(url) {
return await fetchWithProxy(url);
}

// RSS Parser
function parseRSS(xmlText) {
const articles = [];
const parser = new DOMParser();
const xmlDoc = parser.parseFromString(xmlText, "text/xml");

const items = xmlDoc.querySelectorAll('item, entry');

items.forEach((item, index) => {
if (index >= 5) return; // Limit to 5 per source

const title = item.querySelector('title')?.textContent || 'No title';
const link = item.querySelector('link')?.textContent ||
item.querySelector('link')?.getAttribute('href') || '#';

if (title && link !== '#') {
articles.push({
title: cleanTitle(title),
link: link,
timeAgo: 'Recently'
});
}
});

return articles;
}

// Custom parsers for sites without RSS
function parseHackerNews(html) {
const articles = [];
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');

const rows = doc.querySelectorAll('.athing');

rows.forEach((row, index) => {
if (index >= 10) return;

const titleElem = row.querySelector('.titleline a');
if (titleElem) {
articles.push({
title: titleElem.textContent,
link: titleElem.href,
timeAgo: 'Recently'
});
}
});

return articles;
}

function parseCointelegraph(html) {
const articles = [];
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');

const headlines = doc.querySelectorAll('.post-card__title');

headlines.forEach((headline, index) => {
if (index >= 5) return;

const link = headline.closest('a');
if (link && headline.textContent) {
articles.push({
title: headline.textContent.trim(),
link: 'https://cointelegraph.com' + link.getAttribute('href'),
timeAgo: 'Recently'
});
}
});

return articles;
}

function parseOpenAI(html) {
const articles = [];
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');

const posts = doc.querySelectorAll('.ui-post-card');

posts.forEach((post, index) => {
if (index >= 3) return;

const title = post.querySelector('h3');
const link = post.querySelector('a');

if (title && link) {
articles.push({
title: title.textContent.trim(),
link: 'https://openai.com' + link.getAttribute('href'),
timeAgo: 'Recently'
});
}
});

return articles;
}

function parseAnthropic(html) {
const articles = [];
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');

const posts = doc.querySelectorAll('.blog-post-preview');

posts.forEach((post, index) => {
if (index >= 3) return;

const title = post.querySelector('h3');
const link = post.querySelector('a');

if (title && link) {
articles.push({
title: title.textContent.trim(),
link: 'https://www.anthropic.com' + link.getAttribute('href'),
timeAgo: 'Recently'
});
}
});

return articles;
}

// Fallback data if fetching fails
function fallbackArticles(source, category) {
const fallbacks = {
crypto: [
"Bitcoin ETF sees record inflows as institutions pile in",
"Ethereum Dencun upgrade goes live, reducing L2 fees",
"Solana network activity surges amid memecoin frenzy",
"DeFi protocols hit $100B TVL milestone",
"Regulatory clarity emerging for stablecoins"
],
tech: [
"Apple unveils M4 chip with focus on AI performance",
"Microsoft launches new Copilot Pro subscription",
"Google's Gemini AI now integrated across Workspace",
"Meta releases open-source Llama 3 model",
"Amazon launches AI shopping assistant"
],
ai: [
"OpenAI releases GPT-4.5 with multimodal enhancements",
"Anthropic's Claude 3 outperforms competitors on benchmarks",
"AI agents can now complete complex tasks autonomously",
"Multimodal AI models advance in reasoning capabilities",
"Open-source AI models closing gap with proprietary ones"
],
dev: [
"Rust named most loved language for 8th year in row",
"Node.js 22 released with WebSocket support",
"VSCode's new AI pair programming feature in beta",
"WebAssembly gaining traction for high-performance web apps",
"New JavaScript features in ES2024 specification"
]
};

return fallbacks[category]?.map((title, index) => ({
title: title,
link: `https://${source.toLowerCase()}.com/news/${index}`,
timeAgo: 'Recently',
isFallback: true
})) || [];
}

function loadFallbackData() {
allArticles = [];

for (const category in NEWS_SOURCES) {
for (const source of NEWS_SOURCES[category]) {
const articles = fallbackArticles(source.name, source.category);
allArticles.push(...articles.map(article => ({
...article,
source: source.name,
category: source.category,
timestamp: new Date().getTime() - Math.random() * 1000000
})));
}
}

renderArticles();
}

// Render articles to DOM
function renderArticles() {
filterArticles();
}

function filterArticles() {
const filtered = currentCategory === 'all'
? allArticles
: allArticles.filter(article => article.category === currentCategory);

if (filtered.length === 0) {
articlesContainer.innerHTML = `
<div class="loading">
<p>No articles found for this category.</p>
<button class="refresh-btn" onclick="loadNews()" style="margin-top: 1rem;">Try Again</button>
</div>
`;
return;
}

articlesContainer.innerHTML = filtered.map(article => `
<div class="article-card">
<div class="article-header">
<span class="source-tag">${article.source}</span>
<span class="time-ago">${article.timeAgo}</span>
</div>
<h3 class="article-title">${article.title}</h3>
<a href="${article.link}" class="article-link" target="_blank" rel="noopener noreferrer">
Read full story
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
<polyline points="15 3 21 3 21 9"></polyline>
<line x1="10" y1="14" x2="21" y2="3"></line>
</svg>
</a>
</div>
`).join('');
}

function showLoading() {
articlesContainer.innerHTML = `
<div class="loading">
<div class="loading-spinner"></div>
<p>Fetching latest headlines from ${Object.values(NEWS_SOURCES).flat().length} sources...</p>
</div>
`;
}

function showError(message) {
errorMessage.textContent = message;
errorMessage.style.display = 'block';
}

function hideError() {
errorMessage.style.display = 'none';
}

// Utility functions
function cleanTitle(title) {
return title
.replace(/<[^>]*>/g, '')
.replace(/\[.*?\]/g, '')
.replace(/^[^a-zA-Z0-9]+/, '')
.trim();
}

function removeDuplicates(articles) {
const seen = new Set();
return articles.filter(article => {
const key = article.title.toLowerCase();
if (seen.has(key)) return false;
seen.add(key);
return true;
});
}

// Auto-refresh every 5 minutes
setInterval(loadNews, 5 * 60 * 1000);

// Rotate ads periodically
setInterval(() => {
// This could be used to rotate ad placements
const ads = document.querySelectorAll('.ad-frame iframe');
ads.forEach(ad => {
// Add some animation to attract attention
ad.style.opacity = '0.9';
setTimeout(() => ad.style.opacity = '1', 300);
});
}, 30000); // Every 30 seconds
</script>
</body>
</html>
